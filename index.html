<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ATA 100 ‚Äì Quiz</title>
<style>
:root{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --ok:#22c55e;
  --bof:#fbbf24;
  --bad:#ef4444;
  --btn:#2563eb;
  --surface:#0b1223;
  --border:#334155;
}
/* ===== Palette inspir√©e du logo Sabena technics ===== */
:root[data-theme="light"]{
  --bg:#f5f7fa;
  --card:#ffffff;
  --text:#111827;           /* Texte principal : noir anthracite */
  --muted:#374151;          /* Sous-titres : gris fonc√© */
  --ok:#007A33;             /* Vert Sabena (validation) */
  --bof:#FFD200;            /* Jaune Sabena */
  --bad:#C1121F;            /* Rouge profond (erreur) */
  --btn:#003366;            /* Bleu Sabena */
  --surface:#f0f4f8;        /* Fond clair homog√®ne */
  --border:#cbd5e1;         /* Bordures neutres */
}

:root[data-theme="light"] .opt{
  color: var(--text);
  background:#ffffff;
  border-color: var(--border);
}
:root[data-theme="light"] .opt:hover,
:root[data-theme="light"] .opt:focus{
  outline: 2px solid var(--btn);
  background: color-mix(in srgb, var(--btn) 6%, #fff);
}
:root[data-theme="light"] .opt.correct{
  outline-color: var(--ok);
  background: color-mix(in srgb, var(--ok) 15%, #fff);
  color: var(--text);
}
:root[data-theme="light"] .opt.wrong{
  outline-color: var(--bad);
  background: color-mix(in srgb, var(--bad) 10%, #fff);
  color: var(--text);
}
:root[data-theme="light"] .badge-status.badge-ok{ color: var(--ok); }
:root[data-theme="light"] .badge-status.badge-bof{ color: var(--bof); }
:root[data-theme="light"] .badge-status.badge-bad{ color: var(--bad); }

:root[data-theme="light"] button{ background: var(--btn); color: #fff; }
:root[data-theme="light"] .btn-gray{ background: var(--surface); color: var(--text); }

html,body{height:100%}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:system-ui,Segoe UI,Roboto,sans-serif;
  padding:16px;display:flex;gap:12px;flex-wrap:wrap
}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.15);padding:16px}
.main{flex:1;min-width:340px;max-width:980px}
.side{width:340px;min-width:300px;max-height:90vh;overflow:auto;display:flex;flex-direction:column;gap:12px}
h1{margin:0 0 10px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
select,input,button{padding:8px;border-radius:10px;border:1px solid var(--border);background:var(--surface);color:var(--text)}
button{cursor:pointer;background:var(--btn);color:#fff;border:none}
.btn-gray{background:var(--surface);color:var(--text)}
.pill{background:var(--surface);border:1px solid var(--border);border-radius:999px;padding:6px 10px;display:inline-flex;gap:6px;align-items:center}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.opt{
  background:var(--surface);border:1px solid var(--btn);border-radius:10px;
  padding:14px 16px;cursor:pointer;text-align:left;font-size:1.05rem;font-weight:600;
  transition:transform .12s ease
}
.opt:hover{transform:scale(1.02)}
.opt.correct{outline:2px solid var(--ok);background:rgba(34,197,94,.12)}
.opt.wrong{outline:2px solid var(--bad);background:rgba(239,68,68,.12)}
.muted{color:var(--muted);font-size:.92rem}
.timer{background:var(--surface);border:1px solid var(--border);padding:6px 10px;border-radius:999px}
.badge{background:var(--surface);border:1px solid var(--border);border-radius:999px;padding:2px 8px;font-size:.8rem}
.badge-status{margin-left:8px;padding:2px 10px;border-radius:999px;font-size:.9rem;border:1px solid var(--border);display:none}
.badge-ok{color:var(--ok)}
.badge-bof{color:var(--bof)}
.badge-bad{color:var(--bad)}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid var(--border);text-align:left}
th{color:var(--muted)}
.log{background:var(--surface);padding:10px;border-radius:8px;height:300px;overflow:auto}
.ok{color:var(--ok)} .bof{color:var(--bof)} .bad{color:var(--bad)}
.hl{font-weight:700;text-decoration:underline}
.progressbar{height:8px;background:var(--surface);border:1px solid var(--border);border-radius:999px;overflow:hidden}
.progressbar > div{height:100%;background:var(--btn);width:0%}
.svg-wrap{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:8px}
hr{border:none;border-top:1px solid var(--border);margin:12px 0}
.small{font-size:.9rem}
@media (max-width:640px){
  .grid{grid-template-columns:1fr}
}
</style>
</head>
<body>
  <div class="card main">
    <div class="row" style="justify-content:space-between">
      <h1>‚úàÔ∏è ATA 100 ‚Äì Quiz</h1>
      <button id="themeToggle" class="btn-gray" title="Changer de th√®me">üåô/‚òÄÔ∏è</button>
    </div>

    <!-- Outils -->
    <div class="row">
      <div style="min-width:160px">
        <label class="small">Pseudo</label>
        <input id="pseudoInput" placeholder="Ton nom" maxlength="20" />
      </div>
      <div>
        <label class="small">Mode</label>
        <select id="mode">
          <option value="TRAIN">Entra√Ænement</option>
          <option value="EXAM">Examen</option>
        </select>
      </div>
      <div>
        <label class="small">Temps (s/q)</label>
        <input id="qSeconds" type="number" min="3" max="120" value="7" />
      </div>
      <div>
        <label class="small">Questions</label>
        <select id="qCount">
          <option>10</option><option selected>20</option><option>30</option><option>50</option><option>Tout</option>
        </select>
      </div>
      <div class="pill"><span>‚è±Ô∏è</span><b id="timer">0</b>s</div>
      <div class="pill">Score: <b id="score">0</b></div>
    </div>

    <!-- Question -->
    <div class="card" style="margin-top:10px">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div style="font-size:1.2rem;font-weight:700">
          <span id="progressTxt">Question 0/0</span>
          <span id="prevBadge" class="badge-status">OK</span>
        </div>
        <div class="progressbar" style="flex:1;max-width:360px">
          <div id="progressBar"></div>
        </div>
      </div>
      <p id="question" style="font-size:1.25rem;font-weight:700;margin:8px 0">Clique sur D√©marrer</p>
      <div id="choices" class="grid"></div>
      <div id="feedback" class="muted" style="min-height:28px;margin-top:6px"></div>

      <div class="row" style="margin-top:8px">
        <button id="startBtn">D√©marrer</button>
        <button id="pauseBtn" class="btn-gray" disabled>Pause</button>
        <button id="stopBtn" class="btn-gray" disabled>Stop</button>
        <button id="resumeBtn" class="btn-gray" style="display:none">Reprendre</button>
      </div>
    </div>

    <!-- R√©sum√© -->
    <div id="summaryCard" class="card" style="margin-top:10px;display:none">
      <h3 style="margin:0 0 6px">R√©sum√©</h3>
      <div id="summaryStats" class="muted"></div>
      <div id="summaryList" class="muted" style="height:220px;overflow:auto;margin-top:8px"></div>
      <div class="row" style="margin-top:8px">
        <button id="printSummary" class="btn-gray">Imprimer</button>
        <button id="closeSummary" class="btn-gray">Fermer</button>
      </div>
    </div>

    <!-- Progression -->
    <div class="card" style="margin-top:10px">
      <h3 style="margin:0 0 6px">üìà Progression</h3>
      <div class="svg-wrap"><svg id="chart" viewBox="0 0 320 120" width="100%" height="120" aria-label="Courbe des %"></svg></div>
    </div>
  </div>

  <div class="side">
    <div class="card">
      <h3 style="margin:0 0 6px">Tableau des scores</h3>
      <div class="muted small">Affiche les 10 derniers (stocke 30 max).</div>
      <table>
        <thead><tr><th>Pseudo</th><th>Score</th><th>%</th><th>Date</th></tr></thead>
        <tbody id="scoreTableBody"></tbody>
      </table>
      <div class="row" style="margin-top:6px"><button id="clearScores" class="btn-gray">Effacer</button></div>
    </div>
  </div>

<script>
// ====== Helpers
const $ = s => document.querySelector(s);
const pad2 = n => String(n).padStart(2,'0');
const nowStamp = () => { const d=new Date(); return `${pad2(d.getDate())}/${pad2(d.getMonth()+1)}/${String(d.getFullYear()).slice(-2)} ${pad2(d.getHours())}:${pad2(d.getMinutes())}`; };
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }

// ====== Th√®me
const THEME_KEY='ata_theme';
(function applyTheme(){
  const t = localStorage.getItem(THEME_KEY)||'dark';
  document.documentElement.setAttribute('data-theme', t==='light'?'light':'dark');
})();
$('#themeToggle').onclick=()=>{
  const cur=document.documentElement.getAttribute('data-theme')==='light'?'light':'dark';
  const nxt=cur==='light'?'dark':'light';
  document.documentElement.setAttribute('data-theme',nxt);
  localStorage.setItem(THEME_KEY,nxt);
};

// ====== Storage keys
const LS_SCORES='ata_scores_v2';
const LS_PSEUDO='ata_pseudo_v2';
const LS_SNAPSHOT='ata_snapshot_v1';

// ====== √âtat
let running=false, paused=false, i=0, score=0;
let questionOrder=[], filteredQuestions=[];
let timeLeft=0, tickHandle=null, mode='TRAIN', perQ=7;
let answersLog=[];

// ====== DOM
const qEl=$('#question'), choicesEl=$('#choices'), feedbackEl=$('#feedback');
const timerEl=$('#timer'), scoreEl=$('#score'), progressTxt=$('#progressTxt'), progressBar=$('#progressBar');
const pseudoInput=$('#pseudoInput'); pseudoInput.value=localStorage.getItem(LS_PSEUDO)||'';
pseudoInput.addEventListener('change',()=>localStorage.setItem(LS_PSEUDO,pseudoInput.value.trim()));

// ====== Questions (exemple) ‚Äî remplace/compl√®te par ta liste compl√®te si besoin
  let QUESTIONS = [
  { "q": "√Ä quoi correspond l‚ÄôATA 28 ?", "choices": ["Engine Indicating","Fuel","Hydraulic Power","Rotor Flight Controls"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 75 ?", "choices": ["Electrical Power","Air","Rotor Drive System","Electrical/Electronic Panels and Multipurpose Components"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 77 ?", "choices": ["Engine Indicating","In-Flight Fuel Dispensing","Information Systems","Oxygen"], "answer": 0 },
  { "q": "√Ä quoi correspond l‚ÄôATA 71 ?", "choices": ["Power Plant","Engine Water Injection","Cargo and Accessory Compartments","Standard Practices - Engines"], "answer": 0 },
  { "q": "√Ä quoi correspond l‚ÄôATA 45 ?", "choices": ["Diagnostic and Maintenance System","Time Limits / Maintenance Checks","Propellers","Engine Controls"], "answer": 0 },
  { "q": "√Ä quoi correspond l‚ÄôATA 29 ?", "choices": ["Tail Rotor Drive System","Air","Hydraulic Power","Integrated Modular Avionics"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 37 ?", "choices": ["Vacuum","Hardware","Pneumatic","Blades & Pylons Folding Device"], "answer": 0 },
  { "q": "√Ä quoi correspond l‚ÄôATA 50 ?", "choices": ["Water/Waste","Towing and Taxiing","Cargo and Accessory Compartments","Hardware"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond aux commandes de vol (Flight Controls) ?", "choices": ["ATA 81","ATA 06","ATA 34","ATA 27"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 21 ?", "choices": ["Standard Practices and Structures - General","Standard Practices - Engines","Stabilizers","Air Conditioning and Pressurization"], "answer": 3 },
  { "q": "Quel chapitre ATA correspond √† la boulonnerie/‚ÄúHardware‚Äù ?", "choices": ["ATA 14","ATA 34","ATA 76","ATA 37"], "answer": 0 },
  { "q": "√Ä quoi correspond l‚ÄôATA 44 ?", "choices": ["Water Ballast","Placards and Markings","Cabin Systems","Electrical Power"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 10 ?", "choices": ["Parking, Mooring, Storage and Return to Service","Water/Waste","Rotor Flight Controls","Communications"], "answer": 0 },
  { "q": "Quel chapitre ATA correspond √† l‚Äôoxyg√®ne (Oxygen) ?", "choices": ["ATA 75","ATA 11","ATA 35","ATA 07"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 63 ?", "choices": ["Towing and Taxiing","Air","Rotor Drive System","Standard Practices - Rotor/Propellers"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond au Rotor Drive System (syst√®me d‚Äôentra√Ænement du rotor) ?", "choices": ["ATA 33","ATA 63","ATA 47","ATA 21"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 35 ?", "choices": ["Electrical/Electronic Panels and Multipurpose Components","Cargo and Accessory Compartments","Oxygen","Stabilizers"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 25 ?", "choices": ["Equipment / Furnishings","Cargo and Accessory Compartments","Tail Rotor","Standard Practices - Rotor/Propellers"], "answer": 0 },
  { "q": "Quel chapitre ATA correspond aux panneaux/√©quipements √©lectroniques multiprises (Electrical/Electronic Panels and Multipurpose Components) ?", "choices": ["ATA 11","ATA 48","ATA 39","ATA 25"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond √† l‚Äôinjection d‚Äôeau moteur (Engine Water Injection) ?", "choices": ["ATA 22","ATA 49","ATA 29","ATA 82"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 22 ?", "choices": ["Diagnostic and Maintenance System","Autoflight","Nitrogen Generation System","Water Ballast"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 52 ?", "choices": ["Autoflight","In-Flight Fuel Dispensing","Doors","Oil"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond aux h√©lices (Propellers) ?", "choices": ["ATA 42","ATA 11","ATA 76","ATA 61"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 07 ?", "choices": ["Oxygen","Water/Waste","Lifting and Shoring","Cargo and Accessory Compartments"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond au carburant (Fuel) ?", "choices": ["ATA 22","ATA 28","ATA 70","ATA 57"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 20 ?", "choices": ["Flight Test Installation","Starting","Standard Practices - Airframe","Servicing - Routine Maintenance"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond √† l‚Äôentretien courant (Servicing - Routine Maintenance) ?", "choices": ["ATA 45","ATA 12","ATA 56","ATA 73"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 18 ?", "choices": ["Pneumatic","Diagnostic and Maintenance System","Helicopter Vibration","Nitrogen Generation System"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 56 ?", "choices": ["Turbines (Reciprocating Engines)","Windows","Flight Test Installation","Blades & Pylons Folding Device"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 31 ?", "choices": ["Cargo and Accessory Compartments","Wings","Indicating / Recording System","Communications"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 80 ?", "choices": ["Fuselage","Cabin Systems","Accessory Gearboxes","Starting"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 48 ?", "choices": ["In-Flight Fuel Dispensing","Electrical Power","Oil","Airborne Auxiliary Power"], "answer": 0 },
  { "q": "√Ä quoi correspond l‚ÄôATA 89 ?", "choices": ["Towing and Taxiing","Flight Test Installation","Standard Practices - Rotor/Propellers","Hydraulic Power"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 43 ?", "choices": ["Ignition","Water Ballast","Information Systems","Emergency Solar Panel System"], "answer": 3 },
  { "q": "Quel chapitre ATA correspond aux bo√Ætes d‚Äôaccessoires (Accessory Gearboxes) ?", "choices": ["ATA 74","ATA 83","ATA 46","ATA 75"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 81 ?", "choices": ["Integrated Modular Avionics","Rotor Flight Controls","Parking, Mooring, Storage and Return to Service","Turbines (Reciprocating Engines)"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 30 ?", "choices": ["Time Limits / Maintenance Checks","Information Systems","Ice and Rain Protection","Parking, Mooring, Storage and Return to Service"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond au vide (Vacuum) ?", "choices": ["ATA 78","ATA 54","ATA 37","ATA 08"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 08 ?", "choices": ["Accessory Gearboxes","Blades & Pylons Folding Device","Leveling and Weighing","Water/Waste"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond au train d‚Äôatterrissage (Landing Gear) ?", "choices": ["ATA 74","ATA 25","ATA 30","ATA 32"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 05 ?", "choices": ["Cargo and Accessory Compartments","Wings","Placards and Markings","Time Limits / Maintenance Checks"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 79 ?", "choices": ["Doors","Water Ballast","Oil","Tail Rotor"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 38 ?", "choices": ["Accessory Gearboxes","Water/Waste","Engine","Lights"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 83 ?", "choices": ["Standard Practices - Rotor/Propellers","Accessory Gearboxes","Indicating / Recording System","In-Flight Fuel Dispensing"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 73 ?", "choices": ["Diagnostic and Maintenance System","Doors","Rotor Drive System","Engine - Fuel and Control"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 57 ?", "choices": ["Engine","Hydraulic Power","Wings","Air"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 33 ?", "choices": ["Standard Practices - Rotor/Propellers","Hardware","Lights","Integrated Modular Avionics"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond au d√©marrage (Starting) ?", "choices": ["ATA 73","ATA 44","ATA 80","ATA 67"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 42 ?", "choices": ["Tail Rotor","In-Flight Fuel Dispensing","Integrated Modular Avionics","Doors"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 55 ?", "choices": ["Towing and Taxiing","Emergency Solar Panel System","Indicating / Recording System","Stabilizers"], "answer": 3 },
  { "q": "Quel chapitre ATA correspond aux pratiques standard cellule (Standard Practices - Airframe) ?", "choices": ["ATA 20","ATA 46","ATA 72","ATA 42"], "answer": 0 },
  { "q": "√Ä quoi correspond l‚ÄôATA 76 ?", "choices": ["Stabilizers","Engine Controls","Rotor Flight Controls","Blades & Pylons Folding Device"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 11 ?", "choices": ["Ice and Rain Protection","Placards and Markings","Time Limits / Maintenance Checks","Engine - Fuel and Control"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 54 ?", "choices": ["Dimensions and Areas","Standard Practices - Airframe","Nacelles/Pylons","Placards and Markings"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 26 ?", "choices": ["Flight Controls","Fire Protection","Hydraulic Power","Electrical/Electronic Panels and Multipurpose Components"], "answer": 1 },
  { "q": "Quel chapitre ATA correspond au dispositif de repli des pales/pyl√¥nes (Blades & Pylons Folding Device) ?", "choices": ["ATA 66","ATA 70","ATA 81","ATA 31"], "answer": 0 },
  { "q": "√Ä quoi correspond l‚ÄôATA 51 ?", "choices": ["Starting","Accessory Gearboxes","Standard Practices and Structures - General","Tail Rotor"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond aux commandes moteur (Engine Controls) ?", "choices": ["ATA 53","ATA 79","ATA 14","ATA 76"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 23 ?", "choices": ["Communications","Engine Indicating","Standard Practices - Engines","Leveling and Weighing"], "answer": 0 },
  { "q": "√Ä quoi correspond l‚ÄôATA 24 ?", "choices": ["Ignition","Emergency Solar Panel System","Engine Water Injection","Electrical Power"], "answer": 3 },
  { "q": "Quel chapitre ATA correspond au groupe auxiliaire de puissance (Airborne Auxiliary Power) ?", "choices": ["ATA 06","ATA 49","ATA 83","ATA 48"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 12 ?", "choices": ["Time Limits / Maintenance Checks","Servicing - Routine Maintenance","Ice and Rain Protection","Engine Water Injection"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 70 ?", "choices": ["Hydraulic Power","Power Plant","Blades & Pylons Folding Device","Standard Practices - Engines"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 32 ?", "choices": ["Servicing - Routine Maintenance","Landing Gear","Standard Practices and Structures - General","Placards and Markings"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 39 ?", "choices": ["Airborne Auxiliary Power","Electrical/Electronic Panels and Multipurpose Components","Dimensions and Areas","Engine Water Injection"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 14 ?", "choices": ["Hardware","Rotors","Propellers","Time Limits / Maintenance Checks"], "answer": 0 },
  { "q": "Quel chapitre ATA correspond aux rotors (Rotors) ?", "choices": ["ATA 39","ATA 62","ATA 77","ATA 75"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 61 ?", "choices": ["Engine Indicating","Oil","Integrated Modular Avionics","Propellers"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 82 ?", "choices": ["Cargo and Accessory Compartments","Helicopter Vibration","Engine","Engine Water Injection"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 67 ?", "choices": ["Electrical/Electronic Panels and Multipurpose Components","Cargo and Accessory Compartments","Rotor Flight Controls","Emergency Solar Panel System"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 09 ?", "choices": ["Towing and Taxiing","Vacuum","Engine Indicating","Information Systems"], "answer": 0 },
  { "q": "√Ä quoi correspond l‚ÄôATA 27 ?", "choices": ["Indicating / Recording System","Cabin Systems","Flight Controls","Engine Water Injection"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond au groupe motopropulseur (Power Plant) ?", "choices": ["ATA 71","ATA 75","ATA 49","ATA 57"], "answer": 0 },
  { "q": "√Ä quoi correspond l‚ÄôATA 74 ?", "choices": ["Electrical/Electronic Panels and Multipurpose Components","Hydraulic Power","Ignition","Indicating / Recording System"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 06 ?", "choices": ["Standard Practices - Airframe","Starting","Dimensions and Areas","Nitrogen Generation System"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond aux √©quipements/am√©nagements (Equipment / Furnishings) ?", "choices": ["ATA 42","ATA 08","ATA 25","ATA 10"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond √† la protection contre le givre/pluie (Ice and Rain Protection) ?", "choices": ["ATA 20","ATA 30","ATA 48","ATA 38"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 36 ?", "choices": ["Air","Pneumatic","Integrated Modular Avionics","Helicopter Vibration"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 47 ?", "choices": ["Tail Rotor","Exhaust & Thrust Reverser","Nitrogen Generation System","Rotors"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 66 ?", "choices": ["Blades & Pylons Folding Device","Windows","Hardware","Standard Practices - Engines"], "answer": 0 },
  { "q": "√Ä quoi correspond l‚ÄôATA 41 ?", "choices": ["Servicing - Routine Maintenance","Water Ballast","Blades & Pylons Folding Device","Oxygen"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 46 ?", "choices": ["Pneumatic","Helicopter Vibration","Information Systems","Accessory Gearboxes"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond aux limites de temps/visites (Time Limits / Maintenance Checks) ?", "choices": ["ATA 35","ATA 89","ATA 05","ATA 63"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond au remisage/amarre/retour en service (Parking, Mooring, Storage and Return to Service) ?", "choices": ["ATA 41","ATA 75","ATA 26","ATA 10"], "answer": 3 },
  { "q": "Quel chapitre ATA correspond au pneumatique (Pneumatic) ?", "choices": ["ATA 60","ATA 36","ATA 43","ATA 74"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 72 ?", "choices": ["Ignition","Engine","Standard Practices - Engines","Pneumatic"], "answer": 1 },
  { "q": "Quel chapitre ATA correspond √† l‚Äôindication moteur (Engine Indicating) ?", "choices": ["ATA 89","ATA 66","ATA 77","ATA 26"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 34 ?", "choices": ["Air Conditioning and Pressurization","Tail Rotor","Navigation","Servicing - Routine Maintenance"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 64 ?", "choices": ["Fire Protection","Communications","Emergency Solar Panel System","Tail Rotor"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 62 ?", "choices": ["Water/Waste","Time Limits / Maintenance Checks","Vacuum","Rotors"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 78 ?", "choices": ["Water Ballast","Exhaust & Thrust Reverser","Autoflight","Stabilizers"], "answer": 1 },
  { "q": "Quel chapitre ATA correspond aux plaques et marquages (Placards and Markings) ?", "choices": ["ATA 11","ATA 61","ATA 52","ATA 44"], "answer": 0 },
  { "q": "Quel chapitre ATA correspond aux syst√®mes d‚Äôinformation (Information Systems) ?", "choices": ["ATA 24","ATA 51","ATA 33","ATA 46"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 60 ?", "choices": ["Engine Indicating","Engine Controls","Standard Practices - Rotor/Propellers","Pneumatic"], "answer": 2 },
  { "q": "√Ä quoi correspond l‚ÄôATA 49 ?", "choices": ["Engine Indicating","Hardware","Airborne Auxiliary Power","Flight Test Installation"], "answer": 2 },
  { "q": "Quel chapitre ATA correspond au ballast d‚Äôeau (Water Ballast) ?", "choices": ["ATA 41","ATA 44","ATA 36","ATA 56"], "answer": 0 },
  { "q": "Quel chapitre ATA correspond aux dimensions et surfaces (Dimensions and Areas) ?", "choices": ["ATA 06","ATA 25","ATA 11","ATA 55"], "answer": 0 },
  { "q": "Quel chapitre ATA correspond aux vibrations h√©licopt√®re (Helicopter Vibration) ?", "choices": ["ATA 61","ATA 18","ATA 54","ATA 46"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚ÄôATA 65 ?", "choices": ["Water Ballast","Vacuum","Electrical Power","Tail Rotor Drive System"], "answer": 3 },
  { "q": "√Ä quoi correspond l‚ÄôATA 53 ?", "choices": ["Electrical/Electronic Panels and Multipurpose Components","Fuselage","Turbines (Reciprocating Engines)","Engine Indicating"], "answer": 1 },
  { "q": "√Ä quoi correspond l‚Äôacronyme AMM ?", "choices": ["Aircraft Maintenance Manual", "Advanced Muffin Manual", "Airframe Magic Methods", "Aerospace Meme Museum"], "answer": 0 },

  { "q": "√Ä quoi correspond l‚Äôacronyme IPC ?", 
    "choices": ["Illustrated Parts Catalog", "Integrated Pizza Controller", "In-Plane Connector", "Issuable Parts Certificate"], 
    "answer": 0 },

  { "q": "√Ä quoi correspond l‚Äôacronyme TSM ?", 
    "choices": ["Trouble Shooting Manual", "Thrust Synchronization Module", "Total Safety Manifesto", "Turbojet Snack Menu"], 
    "answer": 0 },

  { "q": "√Ä quoi correspond l‚Äôacronyme CMM ?", 
    "choices": ["Component Maintenance Manual", "Composite Mending Matrix", "Cabin Mood Manager", "Checklist of Mandatory Memes"], 
    "answer": 0 },

  { "q": "√Ä quoi correspond l‚Äôacronyme WDM ?", 
    "choices": ["Wiring Diagram Manual", "Wing De-Icing Map", "Weight & Drag Matrix", "Wi-Fi Deployment Manual"], 
    "answer": 0 },

  { "q": "√Ä quoi correspond l‚Äôacronyme SRM ?", 
    "choices": ["Structural Repair Manual", "Service Readiness Map", "Stability Reference Model", "Snack Refill Manifest"], 
    "answer": 0 },

  { "q": "√Ä quoi correspond l‚Äôacronyme AFM-2 ?", 
    "choices": ["Airplane Flight Manual", "Auxiliary Fuel Management", "Aerodynamic Factors Matrix", "Auto-Feathering Mode 2"], 
    "answer": 0 },

  { "q": "√Ä quoi correspond l‚Äôacronyme AOM ?", 
    "choices": ["Aeroplane Operating Manual", "Avionics Operations Map", "Auxiliary Operations Memorandum", "Aisle Obstacle Manual"], 
    "answer": 0 },

  { "q": "√Ä quoi correspond l‚Äôacronyme CLM ?", 
    "choices": ["Cargo Loading Manual", "Cabin Luggage Manifest", "Center of Lift Mapper", "Cargo Logistics Matrix"], 
    "answer": 0 },

  { "q": "√Ä quoi correspond l‚Äôacronyme MELP ?", 
    "choices": ["Minimum Equipment List Procedures", "Maintenance Error Log Processor", "Modular Engine Limiter Program", "Mega Epic Landing Procedures"], 
    "answer": 0 },

  { "q": "√Ä quoi correspond l‚Äôacronyme MMEL ?", 
    "choices": ["Master Minimum Equipment List", "Main Maintenance Events Log", "Modular Manual of Engineering Limits", "Multi-Mission Equipment Ledger"], 
    "answer": 0 },

  { "q": "√Ä quoi correspond l‚Äôacronyme QRH ?", 
    "choices": ["Quick Reference Handbook", "Quiet Ride Handbook", "Quick Restart Helper", "Qualified Repairs Handbook"], 
    "answer": 0 }
  ];
// üëâ Tu peux coller ici ta grosse liste compl√®te : le code fonctionne pareil.

// ====== Scores (stock 30, affichage 10)
function loadScores(){ try{ return JSON.parse(localStorage.getItem(LS_SCORES)||'[]') }catch{ return [] } }
function saveScores(list){ localStorage.setItem(LS_SCORES, JSON.stringify(list.slice(-30))); }
function addScoreRow(entry){
  const pct = entry.total ? Math.round(entry.score/entry.total*1000)/10 : 0;
  const tr=document.createElement('tr');
  tr.innerHTML = `<td>${entry.name||'‚Äî'}</td><td>${entry.score}/${entry.total}</td><td>${pct}%</td><td>${entry.when}</td>`;
  $('#scoreTableBody').appendChild(tr);
}
function renderScoreTable(){
  const body=$('#scoreTableBody'); body.innerHTML='';
  const list=loadScores(); const view=list.slice(-10).reverse(); // 10 derniers, r√©cents en haut
  view.forEach(addScoreRow);
}
$('#clearScores').onclick=()=>{ localStorage.removeItem(LS_SCORES); renderScoreTable(); drawChart(); };

// ====== Graph progression (utilise jusqu‚Äô√† 30 entr√©es)
function drawChart(){
  const svg=$('#chart'); svg.innerHTML='';
  const list=loadScores(); const values=list.map(e=>Math.round(e.score/e.total*100));
  const N=values.length, W=320, H=120, pad=12;
  // axes
  const ax=document.createElementNS('http://www.w3.org/2000/svg','path');
  ax.setAttribute('d',`M${pad},${H-pad}H${W-pad} M${pad},${pad}V${H-pad}`);
  ax.setAttribute('stroke','currentColor'); ax.setAttribute('fill','none'); ax.setAttribute('opacity','0.4');
  svg.appendChild(ax);
  if(!N) return;
  const start=Math.max(0,N-20), arr=values.slice(start);
  const step=(W-2*pad)/Math.max(1,arr.length-1);
  const pts=arr.map((v,k)=>[pad+k*step,(H-pad)-(v/100)*(H-2*pad)]);
  const d=pts.map((p,k)=>(k?'L':'M')+p[0]+','+p[1]).join(' ');
  const path=document.createElementNS('http://www.w3.org/2000/svg','path');
  path.setAttribute('d',d); path.setAttribute('fill','none'); path.setAttribute('stroke','currentColor');
  svg.appendChild(path);
}
renderScoreTable(); drawChart();

// ====== Timer
function clearTick(){ if(tickHandle){ clearInterval(tickHandle); tickHandle=null; } }
function setTimer(v){ timerEl.textContent=v; }
function startTick(){
  clearTick(); timeLeft=perQ; setTimer(timeLeft);
  tickHandle=setInterval(()=>{ if(paused) return; timeLeft--; setTimer(Math.max(0,timeLeft)); if(timeLeft<=0){ clearTick(); onTimeout(); } },1000);
}

// ====== Progress + badge
function renderProgress(){
  const total=filteredQuestions.length;
  progressTxt.textContent=`Question ${Math.min(i+1,total)}/${total}`;
  const pct = total? Math.round(i/total*100) : 0;
  progressBar.style.width = pct+'%';
}
function showBadge(kind){
  const el=$('#prevBadge'); el.className='badge-status';
  if(!kind){ el.style.display='none'; return; }
  el.style.display='inline-block';
  el.textContent = kind==='ok'?'OK':(kind==='bad'?'FAUX':'BOF');
  el.classList.add(kind==='ok'?'badge-ok':(kind==='bad'?'badge-bad':'badge-bof'));
  setTimeout(()=>{ el.style.display='none'; }, 1500);
}

// ====== Rendu question (m√©lange des r√©ponses)
function renderQuestion(){
  const total=filteredQuestions.length;
  if(i>=total){ finishGame(); return; }

  const current=filteredQuestions[questionOrder[i]];
  const shuffled = current.choices.map((text,idx)=>({text,idx})).sort(()=>Math.random()-0.5);
  current.shuffledMap = shuffled.map(o=>o.idx);
  current.shuffledAnswer = shuffled.findIndex(o=>o.idx===current.answer);

  qEl.textContent=current.q;
  renderProgress();
  feedbackEl.textContent='';
  choicesEl.innerHTML='';

  shuffled.forEach((item, idx)=>{
    const b=document.createElement('button');
    b.className='opt'; b.textContent=item.text;
    b.addEventListener('click', ()=> onSelect(idx, b));
    choicesEl.appendChild(b);
  });

  if(running && !paused) startTick();
}
function highlightGood(){
  const cur=filteredQuestions[questionOrder[i]];
  const good = (cur && typeof cur.shuffledAnswer==='number') ? cur.shuffledAnswer : cur.answer;
  document.querySelectorAll('.opt').forEach((b,idx)=>{ b.disabled=true; if(idx===good) b.classList.add('correct'); });
}
function disableAll(){ document.querySelectorAll('.opt').forEach(b=>b.disabled=true); }

// ====== S√©lection / Timeout
function onSelect(idx, btn){
  if(!running || paused) return;
  clearTick();
  const curQ=filteredQuestions[questionOrder[i]];
  const goodShuffled = (typeof curQ.shuffledAnswer==='number') ? curQ.shuffledAnswer : curQ.answer;
  const pickedOriginal = Array.isArray(curQ.shuffledMap) ? curQ.shuffledMap[idx] : idx;

  // log pour le r√©sum√©
  answersLog[i] = {
    index:i, q:curQ.q, choices:curQ.choices.slice(),
    correctIndex:curQ.answer, pickedIndex:pickedOriginal,
    correct:(idx===goodShuffled), timedOut:false
  };

  if(mode==='TRAIN'){
    highlightGood();
    if(idx===goodShuffled){
      score++; scoreEl.textContent=score;
      feedbackEl.innerHTML = `<span class="ok"><b>Bonne r√©ponse !</b></span>`;
      showBadge('ok');
    }else{
      btn.classList.add('wrong');
      feedbackEl.innerHTML = `<span class="bad"><b>Faux.</b></span>`;
      showBadge('bad');
    }
  }else{
    disableAll(); // examen : pas de correction imm√©diate
  }

  setTimeout(()=>{ i++; renderQuestion(); }, 800);
}
function onTimeout(){
  if(!running) return;
  const curQ=filteredQuestions[questionOrder[i]];
  answersLog[i] = {
    index:i, q:curQ.q, choices:curQ.choices.slice(),
    correctIndex:curQ.answer, pickedIndex:null, correct:false, timedOut:true
  };
  if(mode==='TRAIN'){
    highlightGood();
    feedbackEl.innerHTML = `<span class="muted"><b>Temps √©coul√©.</b></span>`;
    showBadge('bad');
  }else{
    disableAll();
  }
  setTimeout(()=>{ i++; renderQuestion(); }, 800);
}

// ====== S√©lection des questions
function buildFilteredQuestions(){
  let arr = QUESTIONS.map((q,idx)=>({q, idx}));
  const sel = $('#qCount').value;
  if(sel!=='Tout'){
    const target=parseInt(sel,10)||20;
    arr = shuffle(arr).slice(0, Math.min(target, arr.length));
  }else{
    arr = shuffle(arr);
  }
  filteredQuestions = arr.map(o=>o.q);
  questionOrder = shuffle([...filteredQuestions.keys()]);
}

// ====== D√©marrer / Pause / Stop
function resetState(){
  running=false; paused=false; i=0; score=0; answersLog=[];
  scoreEl.textContent='0'; clearTick(); timerEl.textContent='0';
  progressBar.style.width='0%'; progressTxt.textContent='Question 0/0';
  qEl.textContent='Clique sur D√©marrer'; choicesEl.innerHTML=''; feedbackEl.textContent='';
  $('#summaryCard').style.display='none';
}
function startGame(fromSnapshot=false){
  mode = $('#mode').value;
  perQ = parseInt($('#qSeconds').value,10)||7;
  if(!fromSnapshot) buildFilteredQuestions();
  running=true; paused=false; i=0; score=0; answersLog=[];
  renderQuestion();
  $('#pauseBtn').disabled=false; $('#stopBtn').disabled=false;
  saveSnapshot();
}
$('#startBtn').onclick=()=>{ resetState(); startGame(false); };
$('#pauseBtn').onclick=()=>{
  if(!running) return;
  paused = !paused;
  $('#pauseBtn').textContent = paused? 'Reprendre' : 'Pause';
  if(!paused) startTick();
  saveSnapshot();
};
$('#stopBtn').onclick=()=> finishGame();

// ====== R√©sum√© + enregistrement du score
function recordFinalScore(){
  const name=(pseudoInput.value||'').trim()||'Anonyme';
  const entry = { name, score, total: filteredQuestions.length, when: nowStamp() };
  const list=loadScores(); list.push(entry); saveScores(list);
  renderScoreTable(); drawChart();
}
function buildSummary(){
  const total=filteredQuestions.length;
  let ok=0, bad=0, to=0;
  const lines = answersLog.map((r,idx)=>{
    const corr=r.choices[r.correctIndex];
    const user = r.pickedIndex===null ? '(aucune/temps)' : r.choices[r.pickedIndex];
    if(r.correct) ok++; else if(r.timedOut) to++; else bad++;
    const cls=r.correct?'ok':'bad';
    return `<div class="${cls}">Q${idx+1}. ${r.q}<div class="small">Ta r√©ponse: <b>${user}</b> ‚Äî Corr: <b>${corr}</b></div></div>`;
  }).join('');
  $('#summaryStats').innerHTML = `Score: <b>${score}</b> / ${total} &nbsp; | &nbsp; OK: <span class="ok">${ok}</span> ‚Äì Faux: <span class="bad">${bad}</span> ‚Äì Temps: <span class="bad">${to}</span>`;
  $('#summaryList').innerHTML = lines || '<span class="muted">Rien √† afficher</span>';
}
function finishGame(){
  if(!running) return;
  clearTick(); running=false; paused=false;
  $('#pauseBtn').disabled=true; $('#stopBtn').disabled=true;

  if(mode==='EXAM'){
    score = answersLog.reduce((acc,r)=> acc + (r.correct?1:0), 0);
    scoreEl.textContent=score;
  }
  buildSummary();
  $('#summaryCard').style.display='block';
  recordFinalScore();
  localStorage.removeItem(LS_SNAPSHOT);
}
$('#printSummary').onclick=()=>window.print();
$('#closeSummary').onclick=()=>$('#summaryCard').style.display='none';

// ====== Snapshot (reprendre une partie)
function saveSnapshot(){
  if(!running) return;
  const snap={ t:Date.now(), mode, perQ, i, score, filteredQuestions, questionOrder, answersLog };
  localStorage.setItem(LS_SNAPSHOT, JSON.stringify(snap));
}
function loadSnapshot(){ try{ return JSON.parse(localStorage.getItem(LS_SNAPSHOT)||'null') }catch{ return null } }
function applySnapshot(s){ mode=s.mode; perQ=s.perQ; i=s.i; score=s.score; filteredQuestions=s.filteredQuestions; questionOrder=s.questionOrder; answersLog=s.answersLog||[]; $('#mode').value=mode; $('#qSeconds').value=perQ; scoreEl.textContent=score; renderQuestion(); }
(function maybeShowResume(){
  const s=loadSnapshot(); if(!s) return;
  const btn=$('#resumeBtn'); btn.style.display='inline-block';
  btn.onclick=()=>{ btn.style.display='none'; running=true; paused=false; applySnapshot(s); $('#pauseBtn').disabled=false; $('#stopBtn').disabled=false; startTick(); };
})();

// ====== Wire + boot
$('#mode').addEventListener('change', saveSnapshot);
$('#qSeconds').addEventListener('change', saveSnapshot);
$('#qCount').addEventListener('change', saveSnapshot);
(function boot(){ progressTxt.textContent='Question 0/0'; timerEl.textContent='0'; renderScoreTable(); drawChart(); })();
</script>
</body>
</html>
